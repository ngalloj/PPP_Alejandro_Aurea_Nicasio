<!-- frontend/src/app/pages/clientes-citas/clientes-citas.component.html -->

<mat-card>
  <h2>GestiÃ³n de Citas y Clientes</h2>

  <form [formGroup]="citaForm" (ngSubmit)="crearCita()">
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 20px;">
      
      <!-- DNI del Cliente -->
      <mat-form-field>
        <mat-label>DNI del Cliente</mat-label>
        <input matInput formControlName="usuario_dni" placeholder="12345678A" required>
        <mat-hint>Formato: 12345678A</mat-hint>
        <mat-error *ngIf="citaForm.get('usuario_dni')?.hasError('required')">
          El DNI es obligatorio
        </mat-error>
        <mat-error *ngIf="citaForm.get('usuario_dni')?.hasError('pattern')">
          Formato invÃ¡lido (debe ser 8 nÃºmeros + 1 letra)
        </mat-error>
      </mat-form-field>

      <!-- ID del Animal (opcional) -->
      <mat-form-field>
        <mat-label>ID del Animal (opcional)</mat-label>
        <input matInput type="number" formControlName="animal_id" placeholder="ID del animal">
        <mat-hint>Deja en blanco si no aplica</mat-hint>
      </mat-form-field>

      <!-- Fecha y Hora -->
      <mat-form-field>
        <mat-label>Fecha y Hora de la Cita</mat-label>
        <input matInput type="datetime-local" formControlName="fecha" required>
        <mat-error *ngIf="citaForm.get('fecha')?.hasError('required')">
          La fecha es obligatoria
        </mat-error>
      </mat-form-field>

      <!-- Motivo -->
      <mat-form-field>
        <mat-label>Motivo de la Cita</mat-label>
        <textarea matInput formControlName="motivo" rows="2" placeholder="Describe el motivo de la consulta"></textarea>
      </mat-form-field>

    </div>

    <button mat-raised-button color="primary" type="submit" [disabled]="!citaForm.valid">
      ğŸ’¾ Guardar Cita
    </button>
  </form>
</mat-card>

<!-- Tabla de Citas -->
<mat-card style="margin-top: 20px;">
  <h3>Citas Registradas ({{ citas.length }})</h3>
  
  <div *ngIf="citas.length === 0" style="text-align: center; padding: 40px; color: #999;">
    No hay citas registradas
  </div>

  <table mat-table [dataSource]="citas" *ngIf="citas.length > 0">
    
    <!-- Columna DNI Cliente -->
    <ng-container matColumnDef="usuario_dni">
      <th mat-header-cell *matHeaderCellDef>DNI Cliente</th>
      <td mat-cell *matCellDef="let cita">
        <strong>{{ cita.usuario_dni }}</strong>
      </td>
    </ng-container>

    <!-- Columna Animal -->
    <ng-container matColumnDef="animal">
      <th mat-header-cell *matHeaderCellDef>Animal</th>
      <td mat-cell *matCellDef="let cita">
        <span *ngIf="cita.Animal">
          {{ cita.Animal.nombre }} ({{ cita.Animal.especie }})
        </span>
        <span *ngIf="!cita.Animal" style="color: #999;">
          Sin animal asignado
        </span>
      </td>
    </ng-container>

    <!-- Columna Fecha -->
    <ng-container matColumnDef="fecha">
      <th mat-header-cell *matHeaderCellDef>Fecha</th>
      <td mat-cell *matCellDef="let cita">
        {{ formatearFecha(cita.fecha) }}
      </td>
    </ng-container>

    <!-- Columna Motivo -->
    <ng-container matColumnDef="motivo">
      <th mat-header-cell *matHeaderCellDef>Motivo</th>
      <td mat-cell *matCellDef="let cita">
        {{ cita.motivo || 'Sin especificar' }}
      </td>
    </ng-container>

    <!-- Columna Acciones -->
    <ng-container matColumnDef="accion">
      <th mat-header-cell *matHeaderCellDef>Acciones</th>
      <td mat-cell *matCellDef="let cita">
        <button mat-button color="primary" (click)="verCliente(cita)">
          ğŸ‘ï¸ Ver
        </button>
        <button mat-button color="warn" (click)="eliminar(cita.id)">
          ğŸ—‘ï¸ Eliminar
        </button>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
  </table>
</mat-card>
