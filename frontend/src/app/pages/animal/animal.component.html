<!-- frontend/src/app/pages/animal/animal.component.html -->

<mat-card>
  <h2>Gestión de Animales</h2>

  <form [formGroup]="animalForm" (ngSubmit)="crearAnimal()">
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
      <mat-form-field>
        <mat-label>Nombre del Animal</mat-label>
        <input matInput formControlName="nombre" placeholder="Nombre" required>
      </mat-form-field>

      <mat-form-field>
        <mat-label>Especie</mat-label>
        <input matInput formControlName="especie" placeholder="Perro, Gato, etc." required>
      </mat-form-field>

      <mat-form-field>
        <mat-label>Edad (años)</mat-label>
        <input matInput type="number" formControlName="edad" placeholder="Edad" required>
      </mat-form-field>

      <mat-form-field>
        <mat-label>Peso (kg)</mat-label>
        <input matInput type="number" step="0.01" formControlName="peso" placeholder="Peso">
      </mat-form-field>

      <mat-form-field>
        <mat-label>DNI del Propietario</mat-label>
        <input matInput formControlName="usuario_dni" placeholder="12345678A" required>
        <mat-hint>Formato: 12345678A</mat-hint>
      </mat-form-field>

      <mat-form-field>
        <mat-label>Motivo de Atención</mat-label>
        <textarea matInput formControlName="motivo_atencion" rows="2" placeholder="Descripción"></textarea>
      </mat-form-field>

      <mat-form-field>
        <mat-label>Fecha de Atención</mat-label>
        <input matInput type="datetime-local" formControlName="fecha_atencion">
      </mat-form-field>
    </div>

    <app-upload-foto (fotoSeleccionada)="onFotoSeleccionada($event)"></app-upload-foto>

    <button mat-raised-button color="primary" type="submit" [disabled]="!animalForm.valid">
      Guardar Animal
    </button>
  </form>
</mat-card>

<mat-card style="margin-top: 20px;">
  <h3>Animales Registrados</h3>
  
  <table mat-table [dataSource]="animales">
    <!-- Columna Foto -->
    <ng-container matColumnDef="foto">
      <th mat-header-cell *matHeaderCellDef>Foto</th>
      <td mat-cell *matCellDef="let animal">
        <img *ngIf="animal.foto_url" [src]="getFotoUrl(animal.foto_url)" 
             alt="Foto de {{animal.nombre}}" 
             style="width: 50px; height: 50px; object-fit: cover; border-radius: 4px;">
        <span *ngIf="!animal.foto_url" style="color: #999;">Sin foto</span>
      </td>
    </ng-container>

    <ng-container matColumnDef="nombre">
      <th mat-header-cell *matHeaderCellDef>Nombre</th>
      <td mat-cell *matCellDef="let animal">{{ animal.nombre }}</td>
    </ng-container>

    <ng-container matColumnDef="especie">
      <th mat-header-cell *matHeaderCellDef>Especie</th>
      <td mat-cell *matCellDef="let animal">{{ animal.especie }}</td>
    </ng-container>

    <ng-container matColumnDef="propietario">
      <th mat-header-cell *matHeaderCellDef>DNI Propietario</th>
      <td mat-cell *matCellDef="let animal">{{ animal.usuario_dni }}</td>
    </ng-container>

    <ng-container matColumnDef="motivo">
      <th mat-header-cell *matHeaderCellDef>Motivo</th>
      <td mat-cell *matCellDef="let animal">{{ animal.motivo_atencion || 'N/A' }}</td>
    </ng-container>

    <ng-container matColumnDef="fecha_atencion">
      <th mat-header-cell *matHeaderCellDef>Fecha Atención</th>
      <td mat-cell *matCellDef="let animal">{{ formatearFecha(animal.fecha_atencion) }}</td>
    </ng-container>

    <ng-container matColumnDef="acciones">
      <th mat-header-cell *matHeaderCellDef>Acciones</th>
      <td mat-cell *matCellDef="let animal">
        <button mat-button color="primary" (click)="modificar(animal)">Editar</button>
        <button mat-button color="warn" (click)="eliminar(animal.id)">Eliminar</button>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
  </table>

  <mat-paginator 
    [length]="length" 
    [pageSize]="pageSize" 
    [pageIndex]="pageIndex"
    (page)="cargarAnimales($event)">
  </mat-paginator>
</mat-card>
